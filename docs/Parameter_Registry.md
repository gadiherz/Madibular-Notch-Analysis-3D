# Mandibles_WF parameter registry (thresholds, boundaries, fixed heuristics)

This document enumerates fixed (user-chosen) parameters, thresholds, and boundary conditions embedded in the Mandibles_WF_Clean codebase.

Notes
- Distances are in the mesh coordinate units (typically mm if meshes are scaled to mm).
- Angles are given in degrees where expressed as `deg2rad(·)` or `rad2deg(·)`.
- Several routines call MATLAB functions with implicit defaults (for example `boundary`, `linspace`, `isoutlier`). Where relevant, the default behavior is stated.
- The main workflow script is `workflow/Rak_Line_Extraction_WF.m`, which calls `CondLnPrjC3` (condylar delineation) and `NotchLine3` (notch ridge path; file name `src/NotchLine3.m`, function header currently reads `NotchLine2`).

## Active parameters used by the workflow

| ID | Component | Parameter / rule | Location | Current value | If increased | If decreased |
|---|---|---|---|---|---|---|
| PT-01 | Positioning | Vertex-count threshold for outline subsampling | `src/PosOnTable.m:46,95,158` | `Sz > 40e3` triggers subsampling | Subsampling occurs less often; outline uses more vertices (slower, potentially more faithful) | Subsampling occurs more often; outline uses fewer vertices (faster, potentially less faithful) |
| PT-02 | Positioning | Subsample size used for outline boundary extraction | `src/PosOnTable.m:48,97,160` | `nSmp = 40e3` | More boundary fidelity (slower) | Less boundary fidelity (faster) |
| PT-03 | Positioning | Boundary extraction method (implicit shrink factor) | `src/PosOnTable.m:53,102,165`; also `src/CrndNchMin.m:30` | `boundary(x,y)` default shrink factor (MATLAB default is 0.5) | More convex outline (if shrink factor were raised toward 1) | Tighter, more concavity-following outline (if shrink factor were lowered toward 0) |
| PT-04 | Positioning | Strong smoothing for initial curvature-peak configuration | `src/PosOnTable.m:55,104,167` | `FourierCoords(…, Neff = 6)` | Includes more harmonics (less smoothing); peaks become more sensitive to fine-scale outline noise | Fewer harmonics (more smoothing); peaks become more stable but may shift or merge |
| PT-05 | Positioning | Weaker smoothing for peak refinement / tangent finding | `src/PosOnTable.m:57,106,169` | `FourierCoords(…, Neff = 45)` | Less smoothing; angles/tangents track fine detail (more sensitive to noise) | More smoothing; angles/tangents more stable (may blunt local extrema) |
| PT-06 | Positioning | Automatic acceptance of left/right base-angle agreement | `src/PosOnTable.m:134` | `|angNeg - angPos| <= 5°` | More models auto-accepted (higher risk of accepting mismatched solutions) | Fewer models auto-accepted (more manual selection) |
| PT-07 | Fourier curve sampling | Output sampling resolution for Fourier-predicted curves | `src/FourierCoords.m:66` | `NewDist = 0:TotLen/800:TotLen` (≈800 intervals) | Finer sampling (slower, less discretization error) | Coarser sampling (faster, more discretization error) |
| PT-08 | Fourier smoothing | Logistic transition width in Fourier smoothing weights | `src/FourierCoords.m:57` | `Delta = 3` | Slower roll-off of harmonics (less aggressive smoothing) | Faster roll-off of harmonics (more aggressive smoothing) |
| RS-01 | Ramus segmentation | Vertical binning resolution (implicit) | `src/SegRam.m:59-60` | `ZSmpInd = linspace(minZ,maxZ)` (default 100 edges ⇒ 99 bins) | More bins (if specified) yields finer detection of the “rise” location (more sensitive) | Fewer bins yields coarser detection (more stable, less precise) |
| PC-01 | Principal curvature | Neighborhood size for local quadric fitting | `src/SurfPrCurv.m:40-41` | `vNeiSz = 30` nearest neighbors | More smoothing in curvature estimates; reduced sensitivity to local noise (can blur sharp features) | More local sensitivity (can be noisier/less stable) |
| PC-02 | Principal curvature | Outlier definition for curvature coefficients | `src/SurfPrCurv.m:101-102` | `isoutlier(…, 'quartiles')` (MATLAB quartile rule) | If made more permissive: fewer points flagged, more raw noise remains | If made more strict: more points flagged, stronger interpolation influence |
| PC-03 | Principal curvature | Outlier replacement neighborhood | `src/SurfPrCurv.m:106,119` | `knnsearch(…, 'k', 50)` | Smoother/less local interpolation (more blurring) | More local interpolation (potentially noisier) |
| RD-01 | Ridgeness | KNN neighborhood size for ridgeness scoring | `src/CalcRdgnss.m:31-32` | `NSz = 100` | Ridgeness becomes less local and more stable (may dilute narrow ridges) | Ridgeness becomes more local (more sensitive to noise) |
| RD-02 | Ridgeness | Directional inclusion wedge about `KDmax` | `src/CalcRdgnss.m:48-49` | `<= 45°` and `>= 135°` | Wider wedge includes more neighbors (less strict; more contamination) | Narrower wedge includes fewer neighbors (more strict; may miss valid ridge context) |
| RD-03 | Ridgeness | Curvature dominance factor relative to neighbors | `src/CalcRdgnss.m:62-63` | `Kmax(point) > 0.95 * Kmax(neighbor)` | More permissive (closer to 1.0 is stricter); changing upward reduces ridge candidates | More permissive (lower factor) increases ridge candidates but admits flatter points |
| RG-01 | Ridge point selection | High-curvature (ridgeness) threshold percentile | `workflow/Rak_Line_Extraction_WF.m:199,208` | `RCrvPts = find(RCrvns >= RCrvTh(60))` (≈60th percentile) | Fewer ridge candidates (more conservative; higher false-negative risk) | More ridge candidates (less conservative; higher false-positive/noise risk) |
| RG-02 | Ridge connectivity | Neighborhood depth for finding ridge neighbors | `src/RdgConn.m:30` | 4 rings (`for i=1:4`) | Broader connectivity (bridges gaps; more false connections possible) | More local connectivity (more fragmentation) |
| RG-03 | Ridge connectivity | Angular alignment threshold for ridge-neighbor selection | `src/RdgConn.m:71` | keep neighbors with angle `<= 10°` or `>= 170°` | More edges retained (more branching/noise) | Fewer edges retained (more fragmentation) |
| RG-04 | Ridge unification | Neighborhood depth used to aggregate edges around a ridge point | `src/EdgeUni.m:51` | 6 rings (`for i=1:6`) | Aggregates from further away (more merging) | Aggregates more locally (less merging) |
| RG-05 | Ridge unification | Minimum edge count to perform merge/snap step | `src/EdgeUni.m:83` | merge only if `numel(NeiEdgsInd) > 7` | Merges happen more often (more aggressive simplification) | Merges happen less often (less simplification) |
| RG-06 | Ridge centering | Neighborhood depth used in ridge-centering intersection averaging | `src/CenterRidge.m:52` | 2 rings (`for i=1:2`) | Uses broader neighborhood (more smoothing/blurring of ridge center) | Uses narrower neighborhood (more local, potentially noisier) |
| CL-01 | Condyle | Chin-point fallback: “low third” definition | `src/CondLnPrjC3.m:41-43` | `quantile(Y,3)` and select `Y <= first tercile` | Chin-point candidate region expands upward (risk mis-identifying chin) | Chin-point candidate region shrinks (risk failing in incomplete specimens) |
| CL-02 | Condyle | Initial condyle vertex set: distance expansion around ridge seed | `src/CondLnPrjC3.m:57` | `SeedPtDist <= 1.1 * DistThrsh` | Larger InV set (includes more non-condylar surface) | Smaller InV set (risk excluding true condylar surface) |
| CL-03 | Condyle | Condyle vertex set: tightened inclusion after centroid update | `src/CondLnPrjC3.m:60` | `SeedPtDist <= 0.65 * DistThrsh` | Larger final set (more contamination) | Smaller final set (risk truncating condyle) |
| CL-04 | Condyle | Eigenvector-order validation threshold | `src/CondLnPrjC3.m:106-108` | uses `YQnt(65)` (≈65th percentile) | Permits more configurations without swapping axes (risk wrong axis assignment) | Forces axis swap more often (risk unnecessary swaps) |
| CL-05 | Condyle | Angular sampling for “shadow points” around reference point | `src/EdgPtCent.m:24,31-32`; `src/CondLnPrjC3.m:153` | `linspace(-pi,pi,91)` ⇒ 90 slices (4° each) | More slices (if increased) yields finer angular sampling (slower) | Fewer slices yields coarser sampling (faster; more discretization error) |
| CL-06 | Condyle | Reference-point height sweep: step size and starting offset | `src/CondLnPrjC3.m:155-160` | `HFac = 1 + i*0.25` (step 0.25; start near 1) | Larger step covers height range with fewer samples (faster; may miss stable band) | Smaller step samples more densely (slower; potentially more stable selection) |
| CL-07 | Condyle | Reference-point height sweep: maximum height tested | `src/CondLnPrjC3.m:157` | `HFac <= 3*(BHght - mean(Ycondyle))` | Tests higher reference points (more robust to occlusions; more compute) | Tests fewer reference points (faster; potentially less robust) |
| CL-08 | Condyle | Tangency criterion for edge points | `src/FindCondEdgPts.m:42-48` | keep vertices with `85° < TanAng < 95°` | Wider band includes more points (more noise) | Narrower band includes fewer points (risk missing edge points) |
| CL-09 | Condyle | Within-slice “central” point tolerance | `src/EdgPtCent.m:35-36` | keep points with distance `<= min(distance)+1` | More points included per slice (smoother but potentially biased outward) | Fewer points per slice (more local; potentially noisier) |
| CL-10 | Condyle | Outlier detection along angular sequence | `src/EdgPtCent.m:54-57` | `isoutlier(PtDist,'movmedian',5)` plus global `isoutlier` | Larger window (if increased) detects broader-scale deviations (less sensitive to local spikes) | Smaller window detects more local spikes (more sensitive) |
| CL-11 | Condyle | Height-band filtering by stability across sweeps | `src/CondLnPrjC3.m:171-172` | remove heights where `std(CentDists)` is an outlier (quartiles) | More permissive retains noisier sweeps (risk messy line) | More strict removes more sweeps (risk too few sweeps for averaging) |
| CL-12 | Condyle | Secondary angular outlier handling and interpolation | `src/CondLnPrjC3.m:176-187` | `isoutlier` on `CentHVar`, then `filloutliers(DistM,'pchip')` | More permissive keeps spikes (risk jagged line) | More strict removes spikes (risk over-smoothing) |
| CL-13 | Condyle | Snap reconstructed condyle line back to mesh vertices | `workflow/Rak_Line_Extraction_WF.m:222-225` | keep only NN indices with `CondLnDst < 0.5` | More liberal snap retains more points (may accept off-surface artifacts) | More strict snap drops more points (may create gaps / shorter line) |
| NL-01 | Notch | Directional filter for candidate ridge points | `src/NotchLine3.m:51` | keep if projected or 3D angle `<= 0.25*pi` (45°) | More points retained (more noise / off-direction points) | Fewer points retained (risk losing ridge continuity) |
| NL-02 | Notch | Initial step and exclusion radius near coronoid start | `src/NotchLine3.m:82-85` | step `0.25` along `TrgtDir`; exclude points with `dist <= 0.25` | Larger step/exclusion makes start less sensitive to local clutter (risk skipping valid ridge) | Smaller step/exclusion makes start more local (risk being trapped by noise) |
| NL-03 | Notch | Iterative neighborhood radius (start, increment, max) and minimum sample size | `src/NotchLine3.m:103-110` | `d=0.15`, `d+=0.05` until `>=15` points, with cap `d<=0.50+6*RelProg` | Larger radii / higher cap bridges gaps (risk drifting off ridge) | Smaller radii / lower cap is stricter (risk early termination) |
| NL-04 | Notch | Hard stop if too few points remain to fit direction | `src/NotchLine3.m:121-123` | stop if `numel(FitSmp) < 10` | Continues longer (if lowered) but with weak fits | Stops earlier (if raised) but avoids unstable fits |
| NL-05 | Notch | “Behind-point” pruning thresholds | `src/NotchLine3.m:115-117` | prune if dot(`< 0.2`) and exclude FitSmp if dot(`< 0`) | More aggressive pruning (higher thresholds) reduces backtracking but may remove valid points | Less aggressive pruning keeps more candidates (risk backtracking) |
| NL-06 | Notch | Number of nearby candidates used to estimate general ridge direction | `src/NotchLine3.m:129-131` | `ind(1:100)` | Uses broader neighborhood (more stable, potentially less local) | Uses narrower neighborhood (more local, potentially noisier) |
| NL-07 | Notch | Ignore weakly-consistent direction vectors | `src/NotchLine3.m:159-160` | ignore vectors if all correlations `< 0.1` | More vectors ignored (more reliance on remaining cues; may stabilize or underconstrain) | Fewer vectors ignored (more cues, but more conflict/noise) |
| NL-08 | Notch | Weighted combination of direction cues | `src/NotchLine3.m:161-162` | weights `[0.25, 0.25, 0.30, 0.15, 0.05]` | Shifts direction more toward heavily weighted cues (changes ridge tracking behavior) | Shifts direction away from heavily weighted cues |
| NL-09 | Notch | Step size for proposing next point | `src/NotchLine3.m:166` | `DirPt = current + 0.25*PcDirVec` | Larger step may skip over sparse ridge points | Smaller step may slow progress / get stuck in local oscillations |
| NL-10 | Notch | Trailing window used to update `PcDirVecPrv` | `src/NotchLine3.m:172-176` | if `numel(NchLn) >= 10`, use last 9 points (`end-8:end`) | Longer window stabilizes direction (less responsive to curvature changes) | Shorter window is more responsive (more jitter) |
| NL-11 | Notch | Local exclusion radius around current endpoint | `src/NotchLine3.m:183-184` | remove candidates with `dist <= 0.25` | More aggressive exclusion reduces clustering (risk removing valid nearby ridge points) | Less exclusion increases clustering (risk loops) |
| NL-12 | Notch | Strip-pruning around current segment (projection window and distance) | `src/NotchLine3.m:189-191` | projection window `[-0.5, 0.5]` and distance `<= d` | Wider window prunes more aggressively (risk over-pruning) | Narrower window prunes less (risk repeated sampling / clutter) |
| NL-13 | Notch | Termination and snapping to condylar line | `src/NotchLine3.m:205-207` | stop and append `TrgtPt` if `min(CorCondDist) <= 0.5` | Stops earlier (if increased) but may snap prematurely | Stops later (if decreased) but may fail to connect in noisy endpoints |
| NL-14 | Notch | Early termination when distance-to-condyle increases near start | `src/NotchLine3.m:208-209` | if `RelProg <= 0.25` and `min(CorCondDist) > 1.1*CorCondDistOld` stop | More sensitive to divergence (if lowered from 1.1) stops earlier | Less sensitive stops later (risk wandering) |
| CD-01 | Descriptors | Coordinate smoothing for notch curves prior to geometry | `workflow/RamLineWF.m:38-39` | `smooth(…, 10, 'rlowess')` | Stronger smoothing (larger span) reduces noise but blunts local geometry | Weaker smoothing retains detail but increases noise in derivatives |
| CD-02 | Descriptors | Coordinate smoothing for condylar line prior to geometry | `workflow/RamLineWF.m:162-163` | `smooth(…, 7, 'rlowess')` | More smoothing reduces noise but can attenuate genuine curvature | Less smoothing retains detail but increases noise |
| CD-03 | Descriptors | Condyle curvature/torsion outlier handling + smoothing | `workflow/RamLineWF.m:217-224` | `filloutliers(…, 'movmedian',7)` then `smooth(…,7,'rlowess')` | Larger window/span yields smoother series (less local variation) | Smaller window/span yields more local variation (more noise) |
| CD-04 | Descriptors | Exclude ends when selecting peak curvature location/value on notch | `workflow/RamLineWF.m:149,154` | restrict to normalized arc length `(0.2, 0.9)` | Excluding more of the ends reduces endpoint artifacts but may miss true maxima | Excluding less increases chance of endpoint artifacts |
| CD-05 | Curve resampling | Minimum point spacing for equidistant resampling | `src/EquiDistPT.m:36-38` | `RqDist >= 0.75` | Coarser resampling (if raised) stabilizes derivatives but loses detail | Finer resampling (if lowered) retains detail but can increase noise |
| CD-06 | Curvature sign convention | Flip curvature sign if mean is negative | `src/CurvCalc.m:60-62` | if `mean(K) < 0`, set `K = -K` | N/A (rule-based sign normalization) | N/A |
| PK-01 | Peak configuration | Minimum peak counts for accepting the “sock” configuration | `src/JustPeaks.m:31-33` | at least 5 positive and 2 negative peaks | Accepts more cases (if lowered) but increases mis-configuration risk | Rejects more cases (if raised) |
| PK-02 | Peak configuration | Max cyclic shifts attempted to place negative peaks at positions 1 and 3 | `src/JustPeaks.m:41-48` | break after 7 shifts (`m==8`) | More attempts may rescue edge cases but risks accepting unstable configs | Fewer attempts rejects more edge cases |
| CT-01 | Common tangent | Minimum separation between tangent-point candidates (fraction of section) | `src/FindComTanF2.m:54-55` | `0.15` of section length | Larger separation restricts to more distant point pairs (fewer candidates) | Smaller separation increases candidates (more false matches) |
| CT-02 | Common tangent | Tangent angle matching tolerances | `src/FindComTanF2.m:59-61` | `<= 3°` (or `>= 177°`) and slope-consistency `<= 3°` | Wider tolerance accepts more candidates (more false tangents) | Narrower tolerance accepts fewer candidates (more failures) |
| PP-01 | Peak refinement | Peak re-localization window on the high-resolution curve | `src/PercPeaks.m:34-42` | `±0.015` (normalized arc length) | Wider window can correct larger peak shifts (risk jumping to wrong extremum) | Narrower window is conservative (risk failing to refine) |

## Parameters embedded in the interactive fragment-selection app

`apps/CompFragSelect.mlapp` is a zipped App Designer file. The executable code is stored in `apps/CompFragSelect.mlapp → matlab/document.xml`.

| ID | Component | Parameter / rule | Location | Current value | If increased | If decreased |
|---|---|---|---|---|---|---|
| UI-01 | Fragment outline | Outline sampling resolution for 2D Fourier reconstruction | `apps/CompFragSelect.mlapp (matlab/document.xml):99` | `NewDist = 0:TotLen/200:TotLen` (≈200 intervals) | Finer outline sampling (slower; less discretization error) | Coarser outline sampling (faster; more discretization error) |
| UI-02 | Fragment outline | Strong smoothing for initial peak detection (logistic weights) | `apps/CompFragSelect.mlapp (matlab/document.xml):100` | `Wn = 1/(1+exp(1+((n-6)/2)))` (effective Neff≈6; Delta≈2) | Less smoothing (if Neff raised / Delta widened) makes peaks more sensitive | More smoothing (if Neff lowered / Delta narrowed) stabilizes peaks but can merge them |

## Inactive/commented-out parameters (present in code but not executed)

These values are currently commented out or reside in deprecated branches. They are included here only for completeness when auditing historical parameter choices.

| ID | Component | Parameter / rule | Location | Current value | Notes |
|---|---|---|---|---|---|
| IA-01 | Mesh preprocessing | Optional mesh decimation | `workflow/Rak_Line_Extraction_WF.m:75-78` | `reducepatch(…, 300e3)` when `size(v,1) > 300e3` | Commented out |
| IA-02 | Curvature smoothing | Optional Laplacian smoothing of `Kmax`, `Kmin`, `Crvns` | `workflow/Rak_Line_Extraction_WF.m:173-176` | examples: `(25,5)` and `(20,3)` | Commented out |
| IA-03 | Ridge selection | Alternative ridge candidate definition by Gaussian curvature percentiles | `workflow/Rak_Line_Extraction_WF.m:209` | `RKGauss < 5th` or `> 95th` percentile | Commented out |
| IA-04 | Condyle | Alternative distance expansion and axis tests | `src/CondLnPrjC3.m:58,96` | `1.25*DistThrsh`, `MaxDims(1)/MaxDims(3) < 0.75` | Commented out |
| IA-05 | Condyle | RANSAC/harmonics parameters (prototype) | `src/CondLnPrjC3.m:252-258` | `RanSac_Harmonic7(500,20,0.05,…)`, weight mixing `0.2/0.8`, `RanSac_SphrHar(125,30,0.4,…)` | Commented out |
| IA-06 | Notch (legacy) | Alternative neighborhood cap and direction weighting | `src/NotchLine2.m:109,146` | cap `0.50 + 4.5*RelProg`, weights `[0.2,0.15,0.3,0.25,0.1]` | Not called by current workflow |
| IA-07 | Notch (prototype) | Cylinder-based neighbor collection | `src/NotchLine3.m:219-241` | cylinder radius `1.5` and related weights | Commented out |
| IA-08 | Descriptors (legacy) | Fourier-based Frenet–Serret path with fixed 500 samples and logistic smoothing | `workflow/RamLineWF.m:54-62,175-183` | examples: `TotLen/500`, logistic weights based on `0.25*#coeffs` | Commented out |
